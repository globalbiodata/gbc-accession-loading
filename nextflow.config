// includeConfig 'conf/modules.config'

params {
    excluded_files = 'doi.csv'
    accession_types = 'accession_types.json'
    db_creds = 'sqlcreds.json'
    download_url = 'https://europepmc.org/pub/databases/pmc/TextMinedTerms/'
}

profiles {
    test_local {
        executor.name     = 'local'
        cleanup           = false

        params {
            db           = 'gbc-publication-analysis:europe-west2:gbc-sql/gbc-publication-analysis-test'
            wget_options = '-A "hipsci.csv" -A "chebi.csv"'
            batch_size   = 10
        }
    }
    test_cloud {
        cleanup           = false

        workDir           = 'gs://gbc-epmc-accession-loading/nextflow-test'
        conda.enabled     = false
        docker.enabled    = true

        params {
            db           = 'gbc-publication-analysis:europe-west2:gbc-sql/gbc-publication-analysis-test'
            wget_options = '-A "hipsci.csv" -A "chebi.csv"'
            batch_size   = 10
        }

        process {
            executor  = 'google-batch'
            container = 'docker.io/carlacummins/gbc-accessions-nextflow:v1.1'
            // machineType = 'e2-small'
            machineType = 'n1-standard-1'
            disk = '10 GB'
        }

        google {
            project = 'gbc-publication-analysis'
            location = 'europe-west2'

            batch {
                spot = true // spot VMs are preemptible and cheaper, but can be reclaimed at any time
                network = 'my-vpc-network'  // Use the custom VPC to avoid hitting external IP quota
                subnetwork = 'my-private-subnet'  // Private subnet with NAT
                usePrivateAddress = true  // Ensures no external IPs are used
            }
        }

    }
    production {
        workDir            = 'gs://gbc-epmc-accession-loading'
        conda.enabled      = false
        docker.enabled     = true

        executor {
            name = 'google-batch'
            queueSize = 100
        }

        params {
            db           = 'gbc-publication-analysis:europe-west2:gbc-sql/gbc-publication-analysis'
            wget_options = '-A "*.csv"'
            batch_size   = 250
        }

        process {
            container = 'docker.io/carlacummins/gbc-accessions-nextflow:v1.1'
            // machineType = 'e2-small'
            machineType = 'n1-standard-1'
        }

        google {
            project = 'gbc-publication-analysis'
            location = 'europe-west2'
            batch.spot = true
        }
    }
}