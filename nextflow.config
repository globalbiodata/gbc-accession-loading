// includeConfig 'conf/modules.config'

params {
    accession_types = 'accession_types.json'
    db_creds = 'sqlcreds.json'
    download_url = 'https://europepmc.org/pub/databases/pmc/TextMinedTerms/'
    // db_user = secrets.SQLUSER
    // db_pass = secrets.SQLPASS
}

profiles {
    local {
        executor.name = 'local'
    }
    test_local {
        executor.name     = 'local'
        cleanup           = false

        params {
            page_size = 5
            limit     = 20
            db        = 'gbc-publication-analysis:europe-west2:gbc-sql/gbc-publication-analysis-test'
        }
    }
    test_cloud {
        cleanup           = false

        workDir           = 'gs://gbc-epmc-accession-loading/nextflow-test'
        conda.enabled     = false
        docker.enabled    = true

        params {
            page_size = 5
            limit     = 20
            db        = 'gbc-publication-analysis:europe-west2:gbc-sql/gbc-publication-analysis-test'
        }

        process {
            executor  = 'google-batch'
            container = 'docker.io/carlacummins/gbc-accessions-nextflow:v1.1'
            // machineType = 'e2-small'
            machineType = 'n1-standard-1'
            disk = '10 GB'
            // disk.type = 'pd-ssd'   // Use 'pd-standard' for cheaper HDD storage
            // disk.sizeGb = 200      // Set disk size (adjust as nee
        }

        google {
            project = 'gbc-publication-analysis'
            location = 'europe-west2'

            batch {
                spot = true // spot VMs are preemptible and cheaper, but can be reclaimed at any time
                network = 'my-vpc-network'  // Use the custom VPC to avoid hitting external IP quota
                subnetwork = 'my-private-subnet'  // Private subnet with NAT
                usePrivateAddress = true  // Ensures no external IPs are used
            }
        }

    }
    production {
        workDir            = 'gs://gbc-epmc-accession-loading'
        conda.enabled      = false
        docker.enabled     = true

        executor {
            name = 'google-batch'
            queueSize = 100
        }

        params {
            page_size = 250
            limit     = null
            db        = 'gbc-publication-analysis:europe-west2:gbc-sql/gbc-publication-analysis'
        }

        process {
            container = 'docker.io/carlacummins/gbc-accessions-nextflow:v1.1'
            // machineType = 'e2-small'
            machineType = 'n1-standard-1'
        }

        google {
            project = 'gbc-publication-analysis'
            location = 'europe-west2'
            batch.spot = true
        }
    }
}